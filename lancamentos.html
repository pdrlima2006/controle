<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üí∏ Entradas e Sa√≠das</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    header {
      background-color: #003366;
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    form {
      background: white;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    label, select, input {
      display: block;
      margin-bottom: 10px;
      width: 100%;
    }
    button {
      padding: 10px;
      background: #003366;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    a {
      display: inline-block;
      margin-top: 10px;
      color: #003366;
      text-decoration: none;
    }
    canvas {
      margin-top: 30px;
      background: white;
      border-radius: 10px;
      padding: 20px;
    }
    ul {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
    }
    li {
      margin-bottom: 10px;
      cursor: pointer;
    }
    .charts {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
  </style>
</head>
<body>
  <header><h1>üí∏ Entradas e Sa√≠das</h1></header>
  <main>
    <form id="transacaoForm">
      <label>Tipo:</label>
      <select name="tipo" required>
        <option value="entrada">Entrada</option>
        <option value="saida">Sa√≠da</option>
      </select>

      <label>Valor:</label>
      <input type="number" name="valor" step="0.01" required />

      <label>Descri√ß√£o:</label>
      <input type="text" name="descricao" required />

      <label>Data:</label>
      <input type="date" name="data" required />

      <button type="submit">Salvar</button>
    </form>

    <a href="dashboard.html">‚Üê Voltar ao Painel</a>

    <h2>üìã Hist√≥rico</h2>
    <ul id="listaTransacoes"></ul>

    <div class="charts">
      <div>
        <h2>üìä Gr√°fico da Transa√ß√£o Selecionada</h2>
        <canvas id="graficoIndividual" width="300" height="300"></canvas>
      </div>
      <div>
        <h2>üìä Gr√°fico Total do M√™s</h2>
        <button onclick="gerarGraficoMes()">Gerar gr√°fico do m√™s</button>
        <canvas id="graficoMensal" width="300" height="300"></canvas>
      </div>
    </div>
  </main>

  <script>
    const form = document.getElementById('transacaoForm');
    const lista = document.getElementById('listaTransacoes');
    const ctxIndividual = document.getElementById('graficoIndividual').getContext('2d');
    const ctxMensal = document.getElementById('graficoMensal').getContext('2d');
    let graficoIndividual;
    let graficoMensal;
    let transacoes = [];

    function carregarDados() {
      transacoes = JSON.parse(localStorage.getItem('transacoes')) || [];
      atualizarLista();
    }

    function atualizarLista() {
      lista.innerHTML = '';
      transacoes.forEach((t, index) => {
        const li = document.createElement('li');
        li.textContent = `${t.data} - ${t.tipo.toUpperCase()} de R$${Number(t.valor).toFixed(2)} (${t.descricao})`;
        li.addEventListener('click', () => mostrarGraficoIndividual(t));
        li.dataset.index = index;
        lista.appendChild(li);
      });
    }

    function mostrarGraficoIndividual(transacao) {
      if (graficoIndividual) graficoIndividual.destroy();

      const entrada = transacao.tipo === 'entrada' ? transacao.valor : 0;
      const saida = transacao.tipo === 'saida' ? transacao.valor : 0;

      graficoIndividual = new Chart(ctxIndividual, {
        type: 'pie',
        data: {
          labels: ['Entrada', 'Sa√≠da'],
          datasets: [{
            data: [entrada, saida],
            backgroundColor: ['#4CAF50', '#F44336'],
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Salva transa√ß√£o clicada para o gr√°fico do m√™s
      localStorage.setItem('transacaoSelecionada', JSON.stringify(transacao));
    }

    function gerarGraficoMes() {
      const transacao = JSON.parse(localStorage.getItem('transacaoSelecionada'));
      if (!transacao) {
        alert("Clique primeiro em uma transa√ß√£o para gerar o gr√°fico do m√™s.");
        return;
      }

      const dataSelecionada = new Date(transacao.data);
      const mes = dataSelecionada.getMonth();
      const ano = dataSelecionada.getFullYear();

      const doMes = transacoes.filter(t => {
        const data = new Date(t.data);
        return data.getMonth() === mes && data.getFullYear() === ano;
      });

      const totalEntradas = doMes.filter(t => t.tipo === 'entrada').reduce((s, t) => s + Number(t.valor), 0);
      const totalSaidas = doMes.filter(t => t.tipo === 'saida').reduce((s, t) => s + Number(t.valor), 0);

      if (graficoMensal) graficoMensal.destroy();

      graficoMensal = new Chart(ctxMensal, {
        type: 'pie',
        data: {
          labels: [`Entradas em ${mes+1}/${ano}`, `Sa√≠das em ${mes+1}/${ano}`],
          datasets: [{
            data: [totalEntradas, totalSaidas],
            backgroundColor: ['#2196F3', '#FF9800']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const tipo = form.tipo.value;
      const valor = parseFloat(form.valor.value);
      const descricao = form.descricao.value;
      const data = form.data.value;

      const nova = { tipo, valor, descricao, data };
      transacoes.push(nova);
      localStorage.setItem('transacoes', JSON.stringify(transacoes));

      form.reset();
      carregarDados();
    });

    document.addEventListener('DOMContentLoaded', carregarDados);
  </script>
</body>
</html>
